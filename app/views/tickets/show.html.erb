<% @page_title = 'Ticket #' + @ticket.id.to_s %>

<div id="content">
  
<div class="breadcrumbs">
  <ul>
    <li><%= link_to 'Tickets', project_tickets_path(@project) %></li>
    <li>&#187 Ticket #<%= @ticket.id %></li>
  </ul>
</div>

<%= error_messages_for 'ticket' %>
<%= error_messages_for 'change' %>

<% if flash[:notice] %>
  <div class="notice"><p><%= flash[:notice] %></p></div>
<% end %>

<div id="ticket">
  <h1>Ticket #<%= @ticket.id %> (<%= @ticket.status.name %>)<span class="date"><%= @ticket.created_at %></span></h1>
  <h2><%=h @ticket.summary %></h2>

  <table id="ticket-details">
    <tr>
      <td class="info">Reported by:</td>
			<td><%= format_author @ticket.author_text %></td>
			<td class="info">Assigned to:</td>
			<td><%= @ticket.assigned_user.login if @ticket.assigned_user %></td>
    </tr>
    <tr>
      <td class="info">Priority:</td>
      <td><%= @ticket.priority.name %></td>
      <td class="info">Release:</td>
      <td><%= @ticket.release.name unless @ticket.release.nil? %></td>
    </tr>
    <tr>
      <td class="info">Milestone:</td>
      <td><%= @ticket.milestone.name unless @ticket.milestone.nil? %></td>
      <td class="info">Status:</td>
      <td><%= @ticket.status.name%></td>
    </tr>
    <tr>
      <td class="info">Component:</td>
      <td><%= @ticket.component.name unless @ticket.component.nil? %></td>
      <td class="info">&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
  </table>

  <h3>Details by <%= format_author @ticket.author_text %>:</h3>
  <div id="editarea">
    <%= format_and_make_links(@ticket.content) %>
  </div>
</div>

<h3>Changelog:</h3>
<div id="ticket-changes">
  <%= render :partial => @ticket.comments %>
</div>

<% form_for :ticket_comment, @ticket_comment, :url => project_ticket_path(@project, @ticket), :html => {:method => :put, :multipart => true} do |f| %>
  <fieldset>
    <legend>Add comment and/or change ticket properties</legend>
    <label class="first">Name/Email <em>(obligatory)</em>: 
    <%= current_user_author_field('ticket_comment') %></label>
    
    <label>Attachment: 
    <%= f.file_field :uploaded_data %></label>
        
    <label>Comment: 
    <%= f.text_area :content, :rows => 12 %></label>
    
    <label>Ticket Summary: 
    <%= f.text_field :summary %></label>

    <%= render :partial => 'ticket_attributes', :locals => {:instance_variable_name => 'ticket_comment'} %>
    
  </fieldset>
	<%= submit_tag "Submit changes", :class => 'submit' %>

<% end %>
</div>
